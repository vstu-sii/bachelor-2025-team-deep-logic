# Technical Requirements — AI Personal Chef

## 1. Введение
**AI Personal Chef** — интеллектуальная система, которая помогает пользователю готовить блюда из имеющихся продуктов.  
Пользователь фотографирует ингредиенты, система распознаёт их, подбирает рецепты и отправляет уведомления.  
Цель проекта — упростить процесс приготовления пищи и сделать его более удобным и персонализированным.

---

## 2. Use‑cases

## UC1 — Регистрация

| Поле              | Описание |
|-------------------|----------|
| **Название**      | Регистрация |
| **Акторы**        | Пользователь |
| **Предусловия**   | Пользователь ещё не зарегистрирован в системе |
| **Основной сценарий** | 1. Пользователь предоставляет данные для создания учётной записи.<br>2. Система проверяет корректность введённых данных.<br>3. Система создаёт новый аккаунт.<br>4. Пользователь получает доступ к системе. |
| **Постусловия**   | Создан новый аккаунт; пользователь авторизован |
| **Альтернативные сценарии** | Введены некорректные данные → система сообщает об ошибке и предлагает повторить ввод |

---

## UC2 — Вход в систему

| Поле              | Описание |
|-------------------|----------|
| **Название**      | Вход в систему |
| **Акторы**        | Пользователь |
| **Предусловия**   | Пользователь зарегистрирован |
| **Основной сценарий** | 1. Пользователь вводит свои учётные данные.<br>2. Система проверяет корректность данных.<br>3. Система предоставляет пользователю доступ к функционалу. |
| **Постусловия**   | Пользователь авторизован |
| **Альтернативные сценарии** | Введены неверные данные → система сообщает об ошибке и предлагает ввести пароль повторно или создать новый аккаунт |

---

## UC3 — Просмотр истории действий

| Поле              | Описание |
|-------------------|----------|
| **Название**      | Просмотр истории действий |
| **Акторы**        | Пользователь |
| **Предусловия**   | Пользователь авторизован; в системе есть сохранённые данные |
| **Основной сценарий** | 1. Пользователь запрашивает просмотр истории рецептов.<br>2. Система предоставляет список. |
| **Постусловия**   | Пользователь ознакомился с историей |
| **Альтернативные сценарии** | История пуста → система сообщает, что данных нет |

---

## UC4 — Управление профилем

| Поле              | Описание |
|-------------------|----------|
| **Название**      | Управление профилем |
| **Акторы**        | Пользователь |
| **Предусловия**   | Пользователь авторизован |
| **Основной сценарий** | 1. Пользователь открывает раздел профиля.<br>2. Пользователь изменяет данные (имя, предпочтения, ограничения).<br>3. Система сохраняет изменения.<br>4. Новые настройки учитываются при подборе рецептов и меню. |
| **Постусловия**   | Данные профиля обновлены |
| **Альтернативные сценарии** | Введены некорректные данные → система сообщает об ошибке и предлагает её исправить |


## UC5 — Запрос списка рецептов по соответствующим ингредиентам

| Поле              | Описание |
|-------------------|----------|
| **Название**      | Запрос списка рецептов по соответствующим ингредиентам |
| **Акторы**        | Пользователь (основной), Система (AI Personal Chef) |
| **Предусловия**   | Пользователь авторизован в приложении; устройство имеет доступ к камере или галерее; интернет‑соединение активно |
| **Основной сценарий** | 1. Пользователь делает снимок или выбирает фото из галереи.<br>2. Система предоставляет список распознанных ингредиентов. |
| **Постусловия**   | Список распознанных ингредиентов сохранён в истории пользователя; пользователь видит результат на экране |
| **Альтернативные сценарии** | Пользователя просят загрузить новое фото, если ни один продукт не распознан или нужно обработать ингредиенты заново | 

---

## UC6 — Исключение ингредиентов

| Поле              | Описание |
|-------------------|----------|
| **Название**      | Исключение ингредиентов |
| **Акторы**        | Пользователь (основной), Система (AI Personal Chef) |
| **Предусловия**   | Пользователь авторизован; список распознанных продуктов уже сохранён в системе; |
| **Основной сценарий** | 1. Пользователь исключает ингредиенты, которые не хочет использовать.<br>2. Система генерирует список рецептов на основе оставшихся ингредиентов и предоставляет его пользователю. |
| **Постусловия**   | Список рецептов доступен пользователю |
| **Альтернативные сценарии** | Система сгенерирует рецепты заново на основе фидбека пользователя | 

---
## UC7 — Выбор рецепта

| Поле              | Описание |
|-------------------|----------|
| **Название**      | Выбор рецепта |
| **Акторы**        | Пользователь (основной), Система (AI Personal Chef) |
| **Предусловия**   | Пользователь авторизован; список рецептов доступен пользователю; |
| **Основной сценарий** | 1. Пользователь изучает список рецептов и выбирает конкретный один рецепт.<br>2. Система предоставляет в текстовом формате план приготовления блюда.|
| **Постусловия**   | План приготовления выбранного блюда доступен пользователю |
| **Альтернативные сценарии** | Пользователь передумал готовить этот рецепт, переходит обратно к списку рецептов и выбирает один из оставшихся рецептов или система генерирует новые рецепты |

## UC8 — Оставление отзыва

| Поле              | Описание |
|-------------------|----------|
| **Название**      | Оставление отзыва |
| **Акторы**        | Пользователь (основной), Система (AI Personal Chef) |
| **Предусловия**   | Пользователь авторизован; рецепт помечен как приготовленный |
| **Основной сценарий** | 1. Пользователь инициирует оставление отзыва о приготовленном рецепте.<br>2. Пользователь формулирует текстовый отзыв и/или выставляет оценку.<br>3. Система сохраняет отзыв и связывает его с соответствующим рецептом в истории пользователя. |
| **Постусловия**   | Отзыв и/или оценка сохранены; данные учитываются системой для улучшения рекомендаций |
| **Альтернативные сценарии** | Пользователь отказывается оставлять отзыв → система завершает сценарий без сохранения данных |

---

## 3. Функциональные требования (FR)

### UC1 — Регистрация
- **FR‑1.** Система должна предоставлять пользователю возможность создать учётную запись.  
- **FR‑2.** Система должна проверять корректность введённых регистрационных данных.  
- **FR‑3.** Система должна сохранять новый аккаунт в базе данных.  
- **FR‑4.** Система должна авторизовать пользователя после успешной регистрации.  
- **FR‑5.** Система должна информировать пользователя об ошибках при некорректных данных.  

---

### UC2 — Вход в систему
- **FR‑6.** Система должна предоставлять форму для ввода учётных данных.  
- **FR‑7.** Система должна проверять корректность введённых данных при входе.  
- **FR‑8.** Система должна предоставлять доступ к функционалу при успешной авторизации.  
- **FR‑9.** Система должна информировать пользователя об ошибке при неверных данных.  

---

### UC3 — Просмотр истории действий
- **FR‑10.** Система должна хранить историю рецептов и их оценки (при наличии).
- **FR‑11.** Система должна предоставлять пользователю список приготовленных рецептов.  
- **FR‑12.** Система должна информировать пользователя об отсутствии данных, если история пуста.  

---

### UC4 — Управление профилем
- **FR‑13.** Система должна предоставлять пользователю возможность изменять данные профиля (имя, предпочтения, ограничения).  
- **FR‑14.** Система должна сохранять изменения профиля.  
- **FR‑15.** Система должна учитывать обновлённые данные при подборе рецептов и меню.  
- **FR‑16.** Система должна информировать пользователя об ошибках при некорректных данных.  

---

### UC5 — Запрос списка рецептов по ингредиентам
- **FR‑17.** Система должна предоставлять пользователю возможность загрузить фото продуктов.  
- **FR‑18.** Система должна распознавать ингредиенты на фото.  
- **FR‑19.** Система должна сохранять список распознанных ингредиентов в истории пользователя.  
- **FR‑20.** Система должна предоставлять пользователю список распознанных ингредиентов.  
- **FR‑21.** Система должна информировать пользователя о необходимости загрузить новое фото, если продукты не распознаны.  

---

### UC6 — Исключение ингредиентов
- **FR‑22.** Система должна предоставлять пользователю возможность исключать ингредиенты из списка.  
- **FR‑23.** Система должна генерировать список рецептов на основе оставшихся ингредиентов.  
- **FR‑24.** Система должна предоставлять пользователю обновлённый список рецептов.  
- **FR‑25.** Система должна поддерживать повторную генерацию рецептов на основе обратной связи пользователя.  

---

### UC7 — Выбор рецепта
- **FR‑26.** Система должна предоставлять пользователю список доступных рецептов.  
- **FR‑27.** Система должна предоставлять пользователю возможность выбрать один рецепт.  
- **FR‑28.** Система должна предоставлять план приготовления выбранного блюда в текстовом формате.  
- **FR‑29.** Система должна поддерживать возврат к списку рецептов и выбор другого рецепта.  
- **FR‑30.** Система должна поддерживать повторную генерацию списка рецептов.  

---

### UC8 — Оставление отзыва
- **FR‑31.** Система должна предоставлять пользователю возможность оставить отзыв о приготовленном рецепте.  
- **FR‑32.** Система должна предоставлять пользователю возможность выставить оценку рецепту.  
- **FR‑33.** Система должна сохранять отзыв и/или оценку в истории пользователя.  
- **FR‑34.** Система должна учитывать отзывы и оценки для улучшения рекомендаций.  
- **FR‑35.** Система должна завершать сценарий без сохранения данных, если пользователь отказался от отзыва.  


---

## 4. Нефункциональные требования и метрики производительности

### 4.1 Производительность
- Среднее время ответа Backend API ≤ 3 секунд (без учёта внешних API).  
- 95-й перцентиль времени ответа ≤ 5 секунд.  
- Среднее время распознавания фото ≤ 5 секунд, 95-й перцентиль ≤ 7 секунд.  
- Время генерации списка рецептов ≤ 5 секунд при стандартной нагрузке.  

### 4.2 Пропускная способность
- Система должна поддерживать не менее 100 одновременных пользователей без деградации.  
- Поддержка ≥ 1000 запросов в минуту при пиковых нагрузках.  

### 4.3 Доступность
- Доступность Backend API ≥ 99% в месяц.  
- Время восстановления после сбоя ≤ 15 минут (RTO).  
- Потеря данных при сбое ≤ 1 минута (RPO).  

### 4.4 Надёжность
- При сбое внешнего сервиса (VLM, LLM, уведомления) система возвращает fallback‑ответ или сообщение об ошибке ≤ 1 секунды.  
- Все критические операции (регистрация, сохранение истории, отзывы) должны подтверждаться транзакционно.  

### 4.5 Использование ресурсов
- Загрузка CPU ≤ 70%, использование памяти ≤ 75% при пиковой нагрузке.  
- Система должна корректно работать при ограниченных ресурсах (например, на мобильных устройствах со слабым интернетом).  

### 4.6 Безопасность
- Авторизация через JWT.  
- Шифрование соединений (HTTPS, TLS 1.2+).  
- Хранение паролей только в виде хэшей (bcrypt/argon2).  
- Доступ к данным пользователей ограничен ролевой моделью (RBAC).  
- Логирование всех попыток входа и действий администратора.  

### 4.7 Масштабируемость
- Возможность горизонтального масштабирования Backend API.  
- Возможность вынесения сервисов (распознавание, генерация рецептов, уведомления) в отдельные контейнеры/микросервисы.  

### 4.8 Удобство использования
- Единый интерфейс для мобильного и веб‑клиента.  
- Поддержка тёмной/светлой темы.  
- Время обучения пользователя работе с приложением ≤ 5 минут.  
- Доступность интерфейса для людей с ограниченными возможностями (WCAG 2.1 AA).  

### 4.9 Поддерживаемость
- Код должен быть покрыт автотестами не менее чем на 70%.  
- Документация API должна быть доступна в формате OpenAPI/Swagger.  
- Логирование и мониторинг всех ключевых сервисов.  

### 4.10 Переносимость
- Система должна разворачиваться в облачной инфраструктуре (Docker/Kubernetes).  
- Поддержка работы на основных мобильных ОС (Android, iOS) и современных браузерах.  


---

## 5. Технологический стек
- **Frontend:** Flutter  
- **Backend:** Python/FastAPI  
- **Database:** PostgreSQL  
- **Интеграции:**  
  - VLM (распознавание продуктов)  
  - LLM API (подбор рецептов)  
  - Сервис уведомлений (push/email)  

---

## 6. Архитектурные принципы
- Используется модель **C4** для описания архитектуры:  
  - Context Diagram — пользователи и внешние системы.  
  - Container Diagram — мобильное/веб‑приложение, Backend API, база данных.  
  - Component Diagram — внутренняя структура Backend API.  
- Backend API реализует бизнес‑логику и взаимодействует с внешними сервисами.  
- Данные пользователей и рецептов хранятся централизованно в PostgreSQL.  
- Уведомления реализуются через внешний сервис (например, Firebase Cloud Messaging или аналог).  
- Принцип **Separation of Concerns**: разделение API, бизнес‑логики, интеграций и слоя данных.  
- Принцип **Fail‑safe defaults**: при сбое внешнего сервиса система возвращает fallback‑ответ.  

---

## 7. Ограничения и допущения
- VLM‑модуль и LLM API предоставляются как внешние сервисы (не разрабатываются в рамках проекта).  
- Система ориентирована на работу в облачной инфраструктуре.  
- Поддерживаются только современные браузеры и мобильные ОС (Android, iOS).  
- Генерация рецептов LLM не гарантирует стабильности → администратор управляет curated‑репозиторием для контроля качества.  

---
