<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        #result, #recipes-result { margin: 20px 0; padding: 15px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .loading { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .processing { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .recipes { background-color: #e8f4fd; color: #0c5460; border: 1px solid #b8daff; }
        #ingredients-list, #recipes-list { margin-top: 10px; }
        .ingredient-item, .recipe-item { padding: 5px 0; border-bottom: 1px solid #eee; }
        .refresh-btn, .generate-btn {
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        .refresh-btn { background-color: #28a745; }
        .refresh-btn:hover { background-color: #218838; }
        .generate-btn { background-color: #007bff; }
        .generate-btn:hover { background-color: #0056b3; }
        .refresh-btn:disabled, .generate-btn:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .task-info {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
        }
        .forbidden-info {
    background: #f8d7da;
    padding: 10px;
    border-radius: 5px;
    border-left: 4px solid #dc3545;
    margin: 5px 0;
    color: #721c24;
}
        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 10px 0;
        }
        .dietary-select, .feedback-input, .param-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 5px 0;
            font-size: 14px;
        }
        .recipe-section {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        .form-group {
            margin: 10px 0;
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π */
.preferences-loading {
    text-align: center;
    padding: 30px;
    background: #f8f9fa;
    border-radius: 10px;
    margin: 20px 0;
    border: 2px dashed #dee2e6;
}

.loading-spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #f3f3f3;
    border-top: 4px solid #007bff;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 15px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.preferences-loading span {
    color: #6c757d;
    font-size: 1.1em;
}
        label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è –±–µ–π–¥–∂–∞ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è */
.user-preferences-info {
    margin-bottom: 20px;
}

.preferences-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: linear-gradient(135deg, #fff3cd, #ffeaa7);
    border: 1px solid #ffc107;
    border-radius: 20px;
    padding: 10px 15px;
    color: #856404;
    font-size: 0.9em;
}

.badge-icon {
    font-size: 1.1em;
}

.badge-text {
    font-weight: 500;
}

/* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ —Å –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è–º–∏ */
.param-select:focus {
    border-color: #ffc107;
    box-shadow: 0 0 0 0.2rem rgba(255, 193, 7, 0.25);
}

/* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∑–Ω–∞—á–µ–Ω–∏–π */
.param-select option[selected] {
    background-color: #fff3cd;
    font-weight: bold;
}
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ */
        .upload-area {
            border: 2px dashed #007bff;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            margin: 20px 0;
            background-color: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .upload-area:hover {
            background-color: #e9ecef;
            border-color: #0056b3;
        }
        .upload-area.dragover {
            background-color: #007bff;
            border-color: #0056b3;
            color: white;
        }
        .upload-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        .file-input {
            display: none;
        }
        .preview-container {
            margin: 20px 0;
            text-align: center;
        }
        .preview-image {
            max-width: 300px;
            max-height: 300px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .file-info {
            margin-top: 10px;
            color: #666;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
            display: none;
        }
        .progress-fill {
            height: 100%;
            background-color: #28a745;
            transition: width 0.3s ease;
        }
        .param-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        @media (max-width: 600px) {
            .param-grid {
                grid-template-columns: 1fr;
            }
        }
        .auto-refresh {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        .auto-refresh-label {
            font-size: 14px;
            color: #666;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤ */
        .recipe-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .recipe-header {
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .recipe-title {
            color: #2c5530;
            font-size: 1.5em;
            margin: 0 0 10px 0;
            font-weight: bold;
        }

        .recipe-meta {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .recipe-meta span {
            background: #f8f9fa;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            border: 1px solid #e9ecef;
        }

        .recipe-section {
            margin: 20px 0;
        }

        .recipe-section h4 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .ingredients-list {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }

        .ingredient-line {
            padding: 3px 0;
            font-size: 0.95em;
        }

        .steps-list {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
        }

        .step {
            padding: 8px 0;
            border-bottom: 1px solid #ffeaa7;
        }

        .step:last-child {
            border-bottom: none;
        }

        .step strong {
            color: #856404;
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –æ—Ç–º–µ—Ç–∫–∏ —à–∞–≥–æ–≤ */
.steps-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    flex-wrap: wrap;
    gap: 10px;
}

.steps-progress {
    background: #f8f9fa;
    padding: 8px 15px;
    border-radius: 20px;
    border: 1px solid #e9ecef;
    font-size: 0.9em;
}

.progress-text {
    color: #6c757d;
}

.progress-value {
    font-weight: bold;
    color: #dc3545;
}

.step-item {
    padding: 10px 0;
    border-bottom: 1px solid #f0f0f0;
}

.step-item:last-child {
    border-bottom: none;
}

.step-checkbox {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    cursor: pointer;
    padding: 5px;
    border-radius: 5px;
    transition: background-color 0.2s;
}

.step-checkbox:hover {
    background-color: #f8f9fa;
}

.step-checkbox input[type="checkbox"] {
    display: none;
}

.checkmark {
    width: 20px;
    height: 20px;
    border: 2px solid #ddd;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: all 0.2s;
    margin-top: 2px;
}

.step-checkbox input[type="checkbox"]:checked + .checkmark {
    background-color: #28a745;
    border-color: #28a745;
}

.step-checkbox input[type="checkbox"]:checked + .checkmark::after {
    content: "‚úì";
    color: white;
    font-size: 14px;
    font-weight: bold;
}

.step-text {
    flex: 1;
    line-height: 1.4;
}

.recipe-completion {
    margin-top: 15px;
    padding: 15px;
    background: #d4edda;
    border-radius: 8px;
    border-left: 4px solid #28a745;
    text-align: center;
}

.completion-badge {
    color: #155724;
    font-weight: bold;
    font-size: 1.1em;
}

.form-actions {
    margin-top: 30px;
    padding: 20px;
    background: #e8f5e8;
    border-radius: 10px;
    text-align: center;
    border-left: 5px solid #28a745;
}

.complete-btn {
    background-color: #28a745;
    font-size: 1.1em;
    padding: 12px 30px;
}

.complete-btn:hover {
    background-color: #218838;
}

.complete-btn:disabled {
    background-color: #6c757d;
    cursor: not-allowed;
}

.saved-recipes-list {
    margin-top: 10px;
    text-align: left;
}

.saved-recipe {
    padding: 5px 0;
    color: #155724;
}

.forbidden-info {
    background: #f8d7da;
    padding: 10px;
    border-radius: 5px;
    border-left: 4px solid #dc3545;
    margin: 5px 0;
    color: #721c24;
}

        .calorie-info {
            background: #d1ecf1;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #17a2b8;
        }

        .calorie-info div {
            margin: 5px 0;
        }

        .recipes-header {
            background: #e8f5e8;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #28a745;
        }

        .used-ingredients {
            font-size: 1.1em;
            margin: 10px 0;
            color: #155724;
        }

        .additional-info {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #c3e6cb;
        }

        .additional-info div {
            margin: 5px 0;
            color: #0c5460;
        }

        .no-recipes {
            text-align: center;
            padding: 40px;
            color: #6c757d;
            font-style: italic;
        }

        .time { color: #007bff; }
        .difficulty { color: #fd7e14; }
        .calorie-level { color: #e83e8c; }
        /* –°—Ç–∏–ª–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
.notification-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    max-width: 400px;
}

.notification {
    background: white;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    border-left: 5px solid #28a745;
    transform: translateX(400px);
    opacity: 0;
    transition: all 0.3s ease;
    display: flex;
    align-items: flex-start;
    gap: 15px;
}

.notification.show {
    transform: translateX(0);
    opacity: 1;
}

.notification.hide {
    transform: translateX(400px);
    opacity: 0;
}

.notification-icon {
    font-size: 24px;
    flex-shrink: 0;
}

.notification-content {
    flex: 1;
}

.notification-title {
    font-weight: bold;
    margin-bottom: 5px;
    color: #155724;
}

.notification-message {
    color: #495057;
    line-height: 1.4;
}

.notification-close {
    background: none;
    border: none;
    font-size: 18px;
    cursor: pointer;
    color: #6c757d;
    padding: 0;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: background-color 0.2s;
}

.notification-close:hover {
    background-color: #f8f9fa;
    color: #495057;
}

/* –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
.notification.success {
    border-left-color: #28a745;
    background: linear-gradient(135deg, #d4edda, #f8fff9);
}

.notification.success .notification-title {
    color: #155724;
}

.notification.info {
    border-left-color: #17a2b8;
    background: linear-gradient(135deg, #d1ecf1, #f8fdff);
}

.notification.info .notification-title {
    color: #0c5460;
}

.notification.warning {
    border-left-color: #ffc107;
    background: linear-gradient(135deg, #fff3cd, #fffdf5);
}

.notification.warning .notification-title {
    color: #856404;
}

.notification.error {
    border-left-color: #dc3545;
    background: linear-gradient(135deg, #f8d7da, #fff8f9);
}

.notification.error .notification-title {
    color: #721c24;
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞ */
.notification-progress {
    height: 3px;
    background: rgba(255,255,255,0.3);
    border-radius: 2px;
    margin-top: 10px;
    overflow: hidden;
}

.notification-progress-bar {
    height: 100%;
    background: currentColor;
    border-radius: 2px;
    transition: width 0.1s linear;
    opacity: 0.7;
}
    </style>
</head>
<body>
    <h1>üç≥ –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤</h1>
    
    <!-- –û–±–ª–∞—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ -->
    <div class="upload-area" id="upload-area">
        <div class="upload-icon">üìÅ</div>
        <h3>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</h3>
        <p>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: JPG, JPEG, PNG</p>
        <p>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10MB</p>
        <input type="file" id="file-input" class="file-input" accept="image/jpeg,image/png" />
    </div>

    <!-- –ü—Ä–µview –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
    <div class="preview-container" id="preview-container" style="display: none;">
        <img id="preview-image" class="preview-image" />
        <div class="file-info" id="file-info"></div>
    </div>

    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä -->
    <div class="progress-bar" id="progress-bar">
        <div class="progress-fill" id="progress-fill"></div>
    </div>

    <!-- –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
    <form id="upload-form" enctype="multipart/form-data" style="display: none;">
        <button type="submit" id="submit-btn" class="generate-btn">üîç –ù–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</button>
    </form>

    <div id="task-section" style="display: none;">
        <div class="task-info">
            <strong>ID –∑–∞–¥–∞—á–∏:</strong> <span id="current-task-id"></span>
            <div><strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="current-status">processing</span></div>
        </div>
        
        <div class="controls">
            <button id="refresh-btn" class="refresh-btn">
                üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
            </button>
            <div class="auto-refresh">
                <input type="checkbox" id="auto-refresh" />
                <label for="auto-refresh" class="auto-refresh-label">–ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–∫–∞–∂–¥—ã–µ 5 —Å–µ–∫)</label>
            </div>
            <span id="refresh-status"></span>
        </div>
    </div>

    <div id="result"></div>

        <div id="recipes-section" style="display: none;">
    <div class="recipe-section">
        <h3>üéØ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤</h3>
        
        <div class="user-preferences-info" id="user-preferences-info" style="display: none;">
            <div class="preferences-badge">
                <span class="badge-icon">‚≠ê</span>
                <span class="badge-text">–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–∞—à–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è</span>
            </div>
        </div>
        
        <div class="preferences-loading" id="preferences-loading">
            <div class="loading-spinner"></div>
            <span>–ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∞—à–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏...</span>
        </div>
        
        <div class="param-grid" id="preferences-grid" style="display: none;">
            <div class="form-group">
                <label for="dietary-select">–î–∏–µ—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è:</label>
                <select id="dietary-select" class="param-select">
                    <option value="–Ω–µ—Ç">–ù–µ—Ç –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π</option>
                    <option value="–≤–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å–∫–æ–µ">–í–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å–∫–æ–µ</option>
                    <option value="–≤–µ–≥–∞–Ω—Å–∫–æ–µ">–í–µ–≥–∞–Ω—Å–∫–æ–µ</option>
                    <option value="–±–µ–∑–≥–ª—é—Ç–µ–Ω–æ–≤–æ–µ">–ë–µ–∑–≥–ª—é—Ç–µ–Ω–æ–≤–æ–µ</option>
                    <option value="–Ω–∏–∑–∫–æ—É–≥–ª–µ–≤–æ–¥–Ω–æ–µ">–ù–∏–∑–∫–æ—É–≥–ª–µ–≤–æ–¥–Ω–æ–µ</option>
                    <option value="–≤—ã—Å–æ–∫–æ–±–µ–ª–∫–æ–≤–æ–µ">–í—ã—Å–æ–∫–æ–±–µ–ª–∫–æ–≤–æ–µ</option>
                </select>
            </div>

            <div class="form-group">
                <label for="difficulty-select">–°–ª–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:</label>
                <select id="difficulty-select" class="param-select">
                    <option value="–Ω–µ—Ç">–õ—é–±–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å</option>
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è –∏–∑ –ë–î -->
                </select>
            </div>

            <div class="form-group">
                <label for="cooking-time-select">–í—Ä–µ–º—è –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:</label>
                <select id="cooking-time-select" class="param-select">
                    <option value="–Ω–µ—Ç">–õ—é–±–æ–µ –≤—Ä–µ–º—è</option>
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è –∏–∑ –ë–î -->
                </select>
            </div>

            <div class="form-group">
                <label for="calorie-level-select">–£—Ä–æ–≤–µ–Ω—å –∫–∞–ª–æ—Ä–∏–π:</label>
                <select id="calorie-level-select" class="param-select">
                    <option value="–Ω–µ—Ç">–õ—é–±–æ–π —É—Ä–æ–≤–µ–Ω—å</option>
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è –∏–∑ –ë–î -->
                </select>
            </div>
        </div>

        <div class="form-group">
            <label for="feedback-input">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è:</label>
            <textarea 
                id="feedback-input" 
                class="feedback-input" 
                placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –±—ã—Å—Ç—Ä–æ–µ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ, –∞–∑–∏–∞—Ç—Å–∫–∞—è –∫—É—Ö–Ω—è, –æ—Å—Ç—Ä—ã–µ –±–ª—é–¥–∞, –±–µ–∑ –º–æ–ª–æ—á–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤..."
                rows="3"
            ></textarea>
        </div>

        <div class="form-group">
            <label for="existing-recipes-input">–ò—Å–∫–ª—é—á–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):</label>
            <input 
                type="text" 
                id="existing-recipes-input" 
                class="feedback-input" 
                placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –æ–º–ª–µ—Ç, —Å–∞–ª–∞—Ç, —Å—É–ø"
            />
        </div>

        <button id="generate-recipes-btn" class="generate-btn">
            üç≥ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç—ã
        </button>
        <span id="generate-status"></span>
    </div>
</div>

<!-- –ü–µ—Ä–µ–¥–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è —á–µ—Ä–µ–∑ —à–∞–±–ª–æ–Ω -->
<script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π
    window.initialPreferences = {
        userPreferences: {{ preferences.user_preferences | tojson | safe }},
        hasUserPreferences: {{ (preferences.user_preferences | default({}) | length > 0) | tojson | safe }}
    };
</script>

    <div id="recipes-result"></div>
    <pre id="response-json"></pre>

    <script>
        const form = document.getElementById('upload-form');
        const fileInput = document.getElementById('file-input');
        const uploadArea = document.getElementById('upload-area');
        const previewContainer = document.getElementById('preview-container');
        const previewImage = document.getElementById('preview-image');
        const fileInfo = document.getElementById('file-info');
        const progressBar = document.getElementById('progress-bar');
        const progressFill = document.getElementById('progress-fill');
        const resultDiv = document.getElementById('result');
        const recipesResultDiv = document.getElementById('recipes-result');
        const responsePre = document.getElementById('response-json');
        const submitBtn = document.getElementById('submit-btn');
        const refreshBtn = document.getElementById('refresh-btn');
        const generateRecipesBtn = document.getElementById('generate-recipes-btn');
        const taskSection = document.getElementById('task-section');
        const recipesSection = document.getElementById('recipes-section');
        const currentTaskIdSpan = document.getElementById('current-task-id');
        const currentStatusSpan = document.getElementById('current-status');
        const refreshStatusSpan = document.getElementById('refresh-status');
        const generateStatusSpan = document.getElementById('generate-status');
        const dietarySelect = document.getElementById('dietary-select');
        const feedbackInput = document.getElementById('feedback-input');
        const difficultySelect = document.getElementById('difficulty-select');
        const cookingTimeSelect = document.getElementById('cooking-time-select');
        const calorieLevelSelect = document.getElementById('calorie-level-select');
        const existingRecipesInput = document.getElementById('existing-recipes-input');
        const autoRefreshCheckbox = document.getElementById('auto-refresh');

        let currentTaskId = null;
        let currentIngredients = [];
        let autoRefreshInterval = null;

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
        uploadArea.addEventListener('click', () => fileInput.click());
        
        fileInput.addEventListener('change', handleFileSelect);
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                handleFileSelect();
            }
        });

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            await startProcessing();
        });

        refreshBtn.addEventListener('click', async () => {
            await checkStatus();
        });

        generateRecipesBtn.addEventListener('click', async () => {
            await generateRecipes();
        });

        autoRefreshCheckbox.addEventListener('change', (e) => {
            if (e.target.checked) {
                autoRefreshInterval = setInterval(() => {
                    if (currentTaskId && currentStatusSpan.textContent === 'processing') {
                        checkStatus();
                    }
                }, 5000);
            } else {
                clearInterval(autoRefreshInterval);
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
        function handleFileSelect() {
            const file = fileInput.files[0];
            if (file) {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
                if (!file.type.match('image/jpeg') && !file.type.match('image/png')) {
                    showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –≤ —Ñ–æ—Ä–º–∞—Ç–µ JPG –∏–ª–∏ PNG');
                    return;
                }

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (–º–∞–∫—Å–∏–º—É–º 10MB)
                if (file.size > 10 * 1024 * 1024) {
                    showError('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 10MB');
                    return;
                }

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é
                const reader = new FileReader();
                reader.onload = (e) => {
                    previewImage.src = e.target.result;
                    previewContainer.style.display = 'block';
                    fileInfo.textContent = `${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
                    form.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        async function startProcessing() {
            const file = fileInput.files[0];
            if (!file) {
                showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);

            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            submitBtn.disabled = true;
            progressBar.style.display = 'block';
            progressFill.style.width = '30%';
            showLoading('–û—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –∞–Ω–∞–ª–∏–∑...');
            hideRecipesSection();

            try {
                // –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å - –Ω–∞—á–∏–Ω–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É
                const startResponse = await fetch('/start-processing', {
                    method: 'POST',
                    body: formData
                });
                
                const startData = await startResponse.json();
                console.log('Start processing response:', startData);
                
                if(startResponse.ok) {
                    progressFill.style.width = '70%';
                    currentTaskId = startData.task_id;
                    currentTaskIdSpan.textContent = currentTaskId;
                    currentStatusSpan.textContent = 'processing';
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é —Å task info –∏ –∫–Ω–æ–ø–∫–æ–π –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                    taskSection.style.display = 'block';
                    showLoading('–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞—á–∞—Ç–∞. –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.');
                    
                    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–∞—Ç—É—Å–∞ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        checkStatus();
                    }, 2000);
                    
                } else {
                    throw new Error(startData.detail || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏');
                }
                
            } catch (error) {
                handleError(error);
            } finally {
                progressFill.style.width = '100%';
                setTimeout(() => {
                    progressBar.style.display = 'none';
                    progressFill.style.width = '0%';
                }, 1000);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞
async function checkStatus() {
    if (!currentTaskId) {
        showError('–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–¥–∞—á–∏');
        return;
    }

    refreshBtn.disabled = true;
    refreshStatusSpan.textContent = '–ü—Ä–æ–≤–µ—Ä—è–µ–º...';
    refreshStatusSpan.style.color = '#007bff';

    try {
        // –í—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å - task_id –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ URL path
        const resultResponse = await fetch(`/get-result/${currentTaskId}`, {
            method: 'GET'
        });
        
        const resultData = await resultResponse.json();
        console.log('Status check response:', resultData);
        
        if(resultResponse.ok) {
            if (resultData.status === 'done') {
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
                currentStatusSpan.textContent = 'done';
                refreshStatusSpan.textContent = '‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—É—á–µ–Ω!';
                refreshStatusSpan.style.color = '#28a745';
                refreshBtn.textContent = 'üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç';
                
                currentIngredients = resultData.ingredients || [];
                displayFinalResult(resultData);
                showRecipesSection();
                
                // –ü–û–ö–ê–ó–´–í–ê–ï–ú –£–í–ï–î–û–ú–õ–ï–ù–ò–ï –û–ë –û–ë–†–ê–ë–û–¢–ö–ï –§–û–¢–û
                showPhotoProcessedNotification(currentTaskId);
                
                // –û—Ç–∫–ª—é—á–∞–µ–º –∞–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
                autoRefreshCheckbox.checked = false;
                clearInterval(autoRefreshInterval);
            } else if (resultData.status === 'processing') {
                // –í—Å–µ –µ—â–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
                currentStatusSpan.textContent = 'processing';
                refreshStatusSpan.textContent = '‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞ –µ—â–µ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞';
                refreshStatusSpan.style.color = '#ffc107';
                refreshBtn.textContent = 'üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–Ω–æ–≤–∞';
                hideRecipesSection();
            } else if (resultData.status === 'error') {
                currentStatusSpan.textContent = 'error';
                refreshStatusSpan.textContent = '‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏';
                refreshStatusSpan.style.color = '#dc3545';
                showError(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ: ${resultData.error}`);
                showErrorNotification(`–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–æ—Ç–æ: ${resultData.error}`);
            }
        } else {
            throw new Error(resultData.detail || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç–∞—Ç—É—Å–∞');
        }
        
    } catch (error) {
        refreshStatusSpan.textContent = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ';
        refreshStatusSpan.style.color = '#dc3545';
        console.error('Error checking status:', error);
        showErrorNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç–∞—Ç—É—Å–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏');
    } finally {
        refreshBtn.disabled = false;
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ–º —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
            if (refreshStatusSpan.textContent.includes('–û—à–∏–±–∫–∞') || 
                refreshStatusSpan.textContent.includes('–ü—Ä–æ–≤–µ—Ä—è–µ–º')) {
                refreshStatusSpan.textContent = '';
            }
        }, 3000);
    }
}
        // –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤
// –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤
async function generateRecipes() {
    if (!currentTaskId) {
        showRecipesError('–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–¥–∞—á–∏');
        showErrorNotification('–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–¥–∞—á–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤');
        return;
    }

    generateRecipesBtn.disabled = true;
    generateStatusSpan.textContent = '–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ—Ü–µ–ø—Ç—ã...';
    generateStatusSpan.style.color = '#007bff';

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    const processingNotification = showProcessingNotification('–ò–¥–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ü–µ–ø—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã—Ö –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤...', 0);

    try {
        // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–µ–º title –∏–∑ –ë–î)
        const cookingTime = document.getElementById('cooking-time-select').value;
        const difficulty = document.getElementById('difficulty-select').value;
        const calorieLevel = document.getElementById('calorie-level-select').value;
        
        console.log('üîß –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:', {
            cookingTime,
            difficulty,
            calorieLevel
        });

        // –°–æ–∑–¥–∞–µ–º FormData –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        const formData = new FormData();
        formData.append('dietary', dietarySelect.value);
        formData.append('user_feedback', feedbackInput.value.trim() || '–Ω–µ—Ç');
        formData.append('preferred_difficulty', difficulty);
        formData.append('preferred_cooking_time', cookingTime);
        formData.append('preferred_calorie_level', calorieLevel);
        formData.append('existing_recipes', existingRecipesInput.value.trim() || '–Ω–µ—Ç');
        /*
        // –í—ã–±–∏—Ä–∞–µ–º endpoint –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞
        const testMode = document.getElementById('test-mode')?.checked ?? true;
        const endpoint = testMode ? 'generate-test-recipes' : 'generate-recipes';
        */
       // –°–¢–ê–õ–û:
        const endpoint = 'generate-recipes';
        const response = await fetch(`/${endpoint}/${currentTaskId}`, {
            method: 'POST',
            body: formData
        });
        
        const resultData = await response.json();
        console.log('Generate recipes response:', resultData);
        
        if(response.ok) {
            generateStatusSpan.textContent = '‚úÖ –†–µ—Ü–µ–ø—Ç—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã!';
            generateStatusSpan.style.color = '#28a745';
            displayRecipesResult(resultData);
            
            // –£–±–∏—Ä–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–æ—Ü–µ—Å—Å–µ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—à–Ω–æ–µ
            if (processingNotification) {
                hideNotification(processingNotification);
            }
            
            // –ü–û–ö–ê–ó–´–í–ê–ï–ú –£–í–ï–î–û–ú–õ–ï–ù–ò–ï –û –ì–ï–ù–ï–†–ê–¶–ò–ò –†–ï–¶–ï–ü–¢–û–í
            const recipesCount = resultData.recipes ? resultData.recipes.length : 0;
            showRecipesGeneratedNotification(recipesCount);
            
        } else {
            throw new Error(resultData.detail || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤');
        }
        
    } catch (error) {
        generateStatusSpan.textContent = '‚ùå ' + error.message;
        generateStatusSpan.style.color = '#dc3545';
        console.error('Error generating recipes:', error);
        
        // –£–±–∏—Ä–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–æ—Ü–µ—Å—Å–µ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
        if (processingNotification) {
            hideNotification(processingNotification);
        }
        showErrorNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤: ' + error.message);
    } finally {
        generateRecipesBtn.disabled = false;
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ–º —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
            generateStatusSpan.textContent = '';
        }, 5000);
    }
}

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
function displayFinalResult(data) {
    let forbiddenInfo = '';
    if (data.forbidden_products_removed && data.forbidden_products_removed.length > 0) {
        forbiddenInfo = `
            <div style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 5px; border-left: 4px solid #ffc107;">
                <strong>üö´ –£—á—Ç–µ–Ω—ã –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã:</strong> ${data.forbidden_products_removed.join(', ')}
            </div>
        `;
    }
    
    resultDiv.innerHTML = `
        <strong>‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω!</strong>
        ${forbiddenInfo}
        <div id="ingredients-list">
            <strong>–ù–∞–π–¥–µ–Ω–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:</strong>
            ${data.ingredients && data.ingredients.length > 0 
                ? data.ingredients.map(ingredient => 
                    `<div class="ingredient-item">‚Ä¢ ${ingredient}</div>`
                  ).join('')
                : '<div>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>'
            }
        </div>
    `;
    resultDiv.className = 'success';
    responsePre.textContent = JSON.stringify(data, null, 2);
}

// –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–µ—Ü–µ–ø—Ç–æ–≤
function displayRecipesResult(data) {
    const recipes = data.recipes || [];
    
    let recipesHtml = '';
    
    if (recipes.length > 0) {
        recipes.forEach((recipe, index) => {
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã
            let ingredientsHtml = '';
            if (recipe.ingredients && Array.isArray(recipe.ingredients)) {
                ingredientsHtml = recipe.ingredients.map(ing => {
                    const amount = ing.amount || '–ø–æ –≤–∫—É—Å—É';
                    return `<div class="ingredient-line">‚Ä¢ ${ing.name} - ${amount}</div>`;
                }).join('');
            }
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —à–∞–≥–∏ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è —Å —á–µ–∫–±–æ–∫—Å–∞–º–∏
            let stepsHtml = '';
            let stepsCount = 0;
            if (recipe.steps && Array.isArray(recipe.steps)) {
                stepsCount = recipe.steps.length;
                stepsHtml = recipe.steps.map((step, stepIndex) => {
                    return `
                        <div class="step-item">
                            <label class="step-checkbox">
                                <input type="checkbox" 
                                       name="completed_steps_${index}" 
                                       value="${stepIndex}"
                                       onchange="updateProgress(${index}, ${stepsCount})">
                                <span class="checkmark"></span>
                                <span class="step-text">
                                    <strong>–®–∞–≥ ${step.order || (stepIndex + 1)}:</strong> ${step.instruction}
                                </span>
                            </label>
                        </div>
                    `;
                }).join('');
            }
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–ª–æ—Ä–∏—è—Ö
            let calorieHtml = '';
            if (recipe.calorie_content) {
                const kcal = recipe.calorie_content.kcal || '?';
                const protein = recipe.calorie_content.protein_g || '?';
                const fat = recipe.calorie_content.fat_g || '?';
                const carb = recipe.calorie_content.carb_g || '?';
                
                calorieHtml = `
                    <div class="calorie-info">
                        <strong>–ü–∏—â–µ–≤–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å (–Ω–∞ –ø–æ—Ä—Ü–∏—é):</strong>
                        <div>–ö–∞–ª–æ—Ä–∏–∏: ${kcal} –∫–∫–∞–ª</div>
                        <div>–ë–µ–ª–∫–∏: ${protein}–≥ | –ñ–∏—Ä—ã: ${fat}–≥ | –£–≥–ª–µ–≤–æ–¥—ã: ${carb}–≥</div>
                    </div>
                `;
            }
            
            recipesHtml += `
                <div class="recipe-card" id="recipe-${index}">
                    <div class="recipe-header">
                        <h3 class="recipe-title">${recipe.name || `–†–µ—Ü–µ–ø—Ç ${index + 1}`}</h3>
                        <div class="recipe-meta">
                            ${recipe.cooking_time ? `<span class="time">‚è± ${recipe.cooking_time}</span>` : ''}
                            ${recipe.difficulty ? `<span class="difficulty">‚ö° ${recipe.difficulty}</span>` : ''}
                            ${recipe.calorie_level ? `<span class="calorie-level">üî• ${recipe.calorie_level}</span>` : ''}
                        </div>
                    </div>
                    
                    <div class="recipe-section">
                        <h4>üõí –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:</h4>
                        <div class="ingredients-list">
                            ${ingredientsHtml || '<div>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã</div>'}
                        </div>
                    </div>
                    
                    <div class="recipe-section">
                        <div class="steps-header">
                            <h4>üë®‚Äçüç≥ –ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ:</h4>
                            <div class="steps-progress">
                                <span class="progress-text">–ü—Ä–æ–≥—Ä–µ—Å—Å: </span>
                                <span class="progress-value" id="progress-${index}">0%</span>
                            </div>
                        </div>
                        <div class="steps-list">
                            ${stepsHtml || '<div>–®–∞–≥–∏ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω—ã</div>'}
                        </div>
                    </div>
                    
                    ${calorieHtml}
                    
                    <div class="recipe-completion" id="completion-${index}" style="display: none;">
                        <div class="completion-badge">‚úÖ –í—Å–µ —à–∞–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã!</div>
                    </div>
                </div>
            `;
        });
    } else {
        recipesHtml = '<div class="no-recipes">–†–µ—Ü–µ–ø—Ç—ã –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã</div>';
    }
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    const additionalInfo = [
        data.feedback_used && data.feedback_used !== '–Ω–µ—Ç' ? 
            `<div><strong>–£—á—Ç–µ–Ω–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è:</strong> ${data.feedback_used}</div>` : '',
        data.preferred_difficulty && data.preferred_difficulty !== '–Ω–µ—Ç' ? 
            `<div><strong>–°–ª–æ–∂–Ω–æ—Å—Ç—å:</strong> ${data.preferred_difficulty}</div>` : '',
        data.preferred_cooking_time && data.preferred_cooking_time !== '–Ω–µ—Ç' ? 
            `<div><strong>–í—Ä–µ–º—è –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:</strong> ${data.preferred_cooking_time}</div>` : '',
        data.preferred_calorie_level && data.preferred_calorie_level !== '–Ω–µ—Ç' ? 
            `<div><strong>–£—Ä–æ–≤–µ–Ω—å –∫–∞–ª–æ—Ä–∏–π:</strong> ${data.preferred_calorie_level}</div>` : '',
        data.saved_to ? `<div><strong>–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤:</strong> ${data.saved_to}</div>` : '',
        data.forbidden_products_considered && data.forbidden_products_considered.length > 0 ? 
            `<div class="forbidden-info">
                <strong>üö´ –ò—Å–∫–ª—é—á–µ–Ω—ã –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã:</strong> ${data.forbidden_products_considered.join(', ')}
            </div>` : ''
    ].filter(Boolean).join('');
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤
    recipesResultDiv.innerHTML = `
        <div class="recipes-header">
            <h2>üç≥ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã</h2>
            <div class="used-ingredients">
                <strong>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:</strong> ${data.ingredients.join(', ')}
            </div>
            ${additionalInfo ? `<div class="additional-info">${additionalInfo}</div>` : ''}
        </div>
        
        <form id="complete-recipes-form" method="post" action="/complete-recipe/${data.task_id}">
            <div id="recipes-list">
                ${recipesHtml}
            </div>
            
            <div class="form-actions" id="form-actions" style="display: none;">
                <button type="submit" class="generate-btn complete-btn">
                    <span class="btn-icon">‚úÖ</span>
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã –≤ –∏—Å—Ç–æ—Ä–∏—é
                </button>
                <span id="save-status"></span>
            </div>
        </form>
    `;
    recipesResultDiv.className = 'recipes';
    responsePre.textContent = JSON.stringify(data, null, 2);
}

// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —à–∞–≥–æ–≤
function updateProgress(recipeIndex, totalSteps) {
    const checkboxes = document.querySelectorAll(`input[name="completed_steps_${recipeIndex}"]:checked`);
    const completedSteps = checkboxes.length;
    const progress = Math.round((completedSteps / totalSteps) * 100);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    const progressElement = document.getElementById(`progress-${recipeIndex}`);
    if (progressElement) {
        progressElement.textContent = `${progress}%`;
        
        // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        if (progress === 100) {
            progressElement.style.color = '#28a745';
            progressElement.style.fontWeight = 'bold';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
            const completionElement = document.getElementById(`completion-${recipeIndex}`);
            if (completionElement) {
                completionElement.style.display = 'block';
            }
        } else if (progress >= 50) {
            progressElement.style.color = '#ffc107';
        } else {
            progressElement.style.color = '#dc3545';
        }
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π —Ä–µ—Ü–µ–ø—Ç
    checkCompletionStatus();
}

// –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ—Ü–µ–ø—Ç–æ–≤
function checkCompletionStatus() {
    const recipeCards = document.querySelectorAll('.recipe-card');
    let hasCompletedRecipe = false;
    
    recipeCards.forEach((card, index) => {
        const progressElement = document.getElementById(`progress-${index}`);
        if (progressElement && progressElement.textContent === '100%') {
            hasCompletedRecipe = true;
        }
    });
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    const formActions = document.getElementById('form-actions');
    if (formActions) {
        formActions.style.display = hasCompletedRecipe ? 'block' : 'none';
    }
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ—Ü–µ–ø—Ç–æ–≤
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('complete-recipes-form');
    if (form) {
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = this.querySelector('.complete-btn');
            const saveStatus = document.getElementById('save-status');
            
            submitBtn.disabled = true;
            saveStatus.textContent = '–°–æ—Ö—Ä–∞–Ω—è–µ–º...';
            saveStatus.style.color = '#007bff';
            
            try {
                const formData = new FormData(this);
                const response = await fetch(this.action, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    saveStatus.textContent = '‚úÖ ' + result.message;
                    saveStatus.style.color = '#28a745';
                    
                    // –ü–û–ö–ê–ó–´–í–ê–ï–ú –£–í–ï–î–û–ú–õ–ï–ù–ò–ï –û –°–û–•–†–ê–ù–ï–ù–ò–ò
                    const savedCount = result.saved_recipes ? result.saved_recipes.length : 0;
                    showRecipesSavedNotification(savedCount);
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤
                    if (result.saved_recipes && result.saved_recipes.length > 0) {
                        const savedList = result.saved_recipes.map(recipe => 
                            `<div class="saved-recipe">‚úÖ ${recipe}</div>`
                        ).join('');
                        
                        saveStatus.innerHTML += `<div class="saved-recipes-list">${savedList}</div>`;
                    }
                    
                    // –ë–ª–æ–∫–∏—Ä—É–µ–º —Ñ–æ—Ä–º—É –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                    submitBtn.style.display = 'none';
                } else {
                    throw new Error(result.detail || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏');
                }
            } catch (error) {
                saveStatus.textContent = '‚ùå ' + error.message;
                saveStatus.style.color = '#dc3545';
                submitBtn.disabled = false;
                showErrorNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤: ' + error.message);
            }
        });
    }
});
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Å–µ–∫—Ü–∏–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤
        function showRecipesSection() {
            recipesSection.style.display = 'block';
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è —Å–µ–∫—Ü–∏–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤
        function hideRecipesSection() {
            recipesSection.style.display = 'none';
            recipesResultDiv.innerHTML = '';
            recipesResultDiv.className = '';
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –∑–∞–≥—Ä—É–∑–∫–∏
        function showLoading(message) {
            resultDiv.textContent = message;
            resultDiv.className = 'loading';
            responsePre.textContent = '';
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –æ—à–∏–±–∫–∏
        function showError(message) {
            resultDiv.textContent = message;
            resultDiv.className = 'error';
            responsePre.textContent = '';
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –æ—à–∏–±–∫–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤
        function showRecipesError(message) {
            recipesResultDiv.textContent = message;
            recipesResultDiv.className = 'error';
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
        function handleError(error) {
            console.error('Error:', error);
            showError(`–û—à–∏–±–∫–∞: ${error.message}`);
            submitBtn.disabled = false;
            taskSection.style.display = 'none';
            hideRecipesSection();
            progressBar.style.display = 'none';
        }
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
function showNotification(type, title, message, duration = 5000) {
    const container = document.getElementById('notification-container');
    if (!container) return;
    
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    
    const icons = {
        success: '‚úÖ',
        info: '‚ÑπÔ∏è',
        warning: '‚ö†Ô∏è',
        error: '‚ùå'
    };
    
    notification.innerHTML = `
        <div class="notification-icon">${icons[type] || 'üí°'}</div>
        <div class="notification-content">
            <div class="notification-title">${title}</div>
            <div class="notification-message">${message}</div>
            ${duration > 0 ? `<div class="notification-progress">
                <div class="notification-progress-bar" style="width: 100%"></div>
            </div>` : ''}
        </div>
        <button class="notification-close" onclick="this.parentElement.remove()">√ó</button>
    `;
    
    container.appendChild(notification);
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
    setTimeout(() => {
        notification.classList.add('show');
    }, 100);
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ
    if (duration > 0) {
        const progressBar = notification.querySelector('.notification-progress-bar');
        if (progressBar) {
            let width = 100;
            const interval = duration / 100;
            const timer = setInterval(() => {
                width -= 1;
                progressBar.style.width = width + '%';
                if (width <= 0) {
                    clearInterval(timer);
                    hideNotification(notification);
                }
            }, interval);
        } else {
            setTimeout(() => {
                hideNotification(notification);
            }, duration);
        }
    }
    
    return notification;
}

function hideNotification(notification) {
    if (!notification) return;
    
    notification.classList.remove('show');
    notification.classList.add('hide');
    
    setTimeout(() => {
        if (notification.parentElement) {
            notification.parentElement.removeChild(notification);
        }
    }, 300);
}

// –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–æ—Ç–æ
function showPhotoProcessedNotification(taskId) {
    showNotification(
        'success',
        'üéâ –§–æ—Ç–æ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ!',
        `–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–¥–∞—á–∏: ${taskId}<br>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤.`,
        6000
    );
}

// –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤
function showRecipesGeneratedNotification(recipesCount) {
    showNotification(
        'success',
        'üç≥ –†–µ—Ü–µ–ø—Ç—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã!',
        `–°–æ–∑–¥–∞–Ω–æ ${recipesCount} —Ä–µ—Ü–µ–ø—Ç–æ–≤.<br>–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –æ—Ç–º–µ—á–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —à–∞–≥–∏.`,
        6000
    );
}

// –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ –∏—Å—Ç–æ—Ä–∏—é
function showRecipesSavedNotification(savedCount) {
    showNotification(
        'success',
        'üìö –†–µ—Ü–µ–ø—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!',
        `${savedCount} —Ä–µ—Ü–µ–ø—Ç–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –≤–∞—à—É –∏—Å—Ç–æ—Ä–∏—é.<br>–í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Ö –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ.`,
        5000
    );
}

// –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
function showErrorNotification(message) {
    showNotification(
        'error',
        '‚ùå –û—à–∏–±–∫–∞',
        message,
        8000
    );
}

// –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ—Ü–µ—Å—Å–µ
function showProcessingNotification(message, duration = 0) {
    return showNotification(
        'info',
        '‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞',
        message,
        duration
    );
}
// –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
async function loadPreferences() {
    const loadingElement = document.getElementById('preferences-loading');
    const gridElement = document.getElementById('preferences-grid');
    const userPreferencesInfo = document.getElementById('user-preferences-info');
    
    try {
        console.log('üîß –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...');
        
        const response = await fetch('/api/preferences');
        const preferencesData = await response.json();
        
        if (response.ok) {
            console.log('‚úÖ –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', preferencesData);
            
            const allPreferences = preferencesData.all_preferences;
            const userPreferences = preferencesData.user_preferences;
            const userId = preferencesData.user_id;
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –ë–î
            fillSelectOptions('cooking-time-select', allPreferences.cooking_times, '–Ω–µ—Ç', '–õ—é–±–æ–µ –≤—Ä–µ–º—è');
            fillSelectOptions('difficulty-select', allPreferences.difficulties, '–Ω–µ—Ç', '–õ—é–±–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å');
            fillSelectOptions('calorie-level-select', allPreferences.calorie_contents, '–Ω–µ—Ç', '–õ—é–±–æ–π —É—Ä–æ–≤–µ–Ω—å');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
            if (userPreferences && Object.keys(userPreferences).length > 0) {
                setUserPreferences(userPreferences);
                userPreferencesInfo.style.display = 'block';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –±–µ–π–¥–∂–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                const badgeText = userPreferencesInfo.querySelector('.badge-text');
                if (badgeText && userId) {
                    badgeText.textContent = `–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–∞—à–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è (ID: ${userId})`;
                }
                
                showNotification('success', '‚≠ê –í–∞—à–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã', 
                                '–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–∞—à–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏', 3000);
            } else {
                if (userId) {
                    showNotification('info', '‚öôÔ∏è –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏', 
                                    '–£ –≤–∞—Å –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.', 3000);
                } else {
                    showNotification('info', '‚öôÔ∏è –ì–æ—Å—Ç–µ–≤–æ–π —Ä–µ–∂–∏–º', 
                                    '–í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.', 3000);
                }
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ—Ç–∫—É –∏ —Å–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            loadingElement.style.display = 'none';
            gridElement.style.display = 'grid';
            
        } else {
            throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π');
        }
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π:', error);
        
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –∏–∑ —à–∞–±–ª–æ–Ω–∞
        if (window.initialPreferences && window.initialPreferences.hasUserPreferences) {
            setUserPreferences(window.initialPreferences.userPreferences);
            userPreferencesInfo.style.display = 'block';
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º fallback –≤–∞—Ä–∏–∞–Ω—Ç—ã
        fillSelectOptions('cooking-time-select', [
            {id: 1, title: '–±—ã—Å—Ç—Ä–æ (<15 –º–∏–Ω)'},
            {id: 2, title: '—Å—Ä–µ–¥–Ω–µ (15-30 –º–∏–Ω)'},
            {id: 3, title: '–¥–æ–ª–≥–æ (>30 –º–∏–Ω)'}
        ], '–Ω–µ—Ç', '–õ—é–±–æ–µ –≤—Ä–µ–º—è');
        
        fillSelectOptions('difficulty-select', [
            {id: 1, title: '–ª–µ–≥–∫–æ'},
            {id: 2, title: '—Å—Ä–µ–¥–Ω–µ'},
            {id: 3, title: '—Å–ª–æ–∂–Ω–æ'}
        ], '–Ω–µ—Ç', '–õ—é–±–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å');
        
        fillSelectOptions('calorie-level-select', [
            {id: 1, title: '–Ω–∏–∑–∫–æ–∫–∞–ª–æ—Ä–∏–π–Ω–æ–µ'},
            {id: 2, title: '—Å—Ä–µ–¥–Ω–µ–∫–∞–ª–æ—Ä–∏–π–Ω–æ–µ'},
            {id: 3, title: '–≤—ã—Å–æ–∫–æ–∫–∞–ª–æ—Ä–∏–π–Ω–æ–µ'}
        ], '–Ω–µ—Ç', '–õ—é–±–æ–π —É—Ä–æ–≤–µ–Ω—å');
        
        loadingElement.style.display = 'none';
        gridElement.style.display = 'grid';
        
        showNotification('warning', '‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏', 
                        '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.', 5000);
    }
}

// –§—É–Ω–∫—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
function setUserPreferences(userPreferences) {
    console.log('üîß –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', userPreferences);
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ title –∏–∑ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
    if (userPreferences.preferred_cooking_time) {
        setSelectValue('cooking-time-select', userPreferences.preferred_cooking_time);
    }
    
    if (userPreferences.preferred_difficulty) {
        setSelectValue('difficulty-select', userPreferences.preferred_difficulty);
    }
    
    if (userPreferences.preferred_calorie_level) {
        setSelectValue('calorie-level-select', userPreferences.preferred_calorie_level);
    }
    
    // –î–∏–µ—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–∫–∞ –æ—Å—Ç–∞–≤–ª—è–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, 
    // —Ç–∞–∫ –∫–∞–∫ –∏—Ö –Ω–µ—Ç –≤ –≤–∞—à–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ User —Ç–∞–±–ª–∏—Ü—ã
}

// –§—É–Ω–∫—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å–µ–ª–µ–∫—Ç–æ—Ä
function setSelectValue(selectId, value) {
    const select = document.getElementById(selectId);
    if (!select) return;
    
    // –ü—Ä–∏–≤–æ–¥–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
    const valueLower = value.toLowerCase().trim();
    
    // –ò—â–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
    for (let i = 0; i < select.options.length; i++) {
        const optionValue = select.options[i].value.toLowerCase().trim();
        if (optionValue === valueLower) {
            select.selectedIndex = i;
            console.log(`‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Ç–æ—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è ${selectId}: "${value}"`);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ
            select.style.borderColor = '#28a745';
            select.style.boxShadow = '0 0 0 0.2rem rgba(40, 167, 69, 0.25)';
            return;
        }
    }
    
    // –ï—Å–ª–∏ —Ç–æ—á–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –Ω–µ—Ç, –∏—â–µ–º —á–∞—Å—Ç–∏—á–Ω–æ–µ
    for (let i = 0; i < select.options.length; i++) {
        const optionValue = select.options[i].value.toLowerCase().trim();
        if (optionValue.includes(valueLower) || valueLower.includes(optionValue)) {
            select.selectedIndex = i;
            console.log(`‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è ${selectId}: "${select.options[i].value}" –≤–º–µ—Å—Ç–æ "${value}"`);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ
            select.style.borderColor = '#ffc107';
            select.style.boxShadow = '0 0 0 0.2rem rgba(255, 193, 7, 0.25)';
            return;
        }
    }
    
    console.log(`‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è ${selectId}: "${value}"`);
}

// –§—É–Ω–∫—Ü–∏—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ –æ–ø—Ü–∏—è–º–∏
function fillSelectOptions(selectId, options, defaultValue, defaultText) {
    const select = document.getElementById(selectId);
    if (!select) return;
    
    // –û—á–∏—â–∞–µ–º –≤—Å–µ –æ–ø—Ü–∏–∏
    select.innerHTML = '';
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–ø—Ü–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    const defaultOption = document.createElement('option');
    defaultOption.value = defaultValue;
    defaultOption.textContent = defaultText;
    select.appendChild(defaultOption);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–ø—Ü–∏–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    options.forEach(option => {
        const optionElement = document.createElement('option');
        optionElement.value = option.title; // –ò—Å–ø–æ–ª—å–∑—É–µ–º title –∫–∞–∫ –∑–Ω–∞—á–µ–Ω–∏–µ
        optionElement.textContent = option.title;
        optionElement.setAttribute('data-id', option.id); // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
        select.appendChild(optionElement);
    });
    
    console.log(`‚úÖ –°–µ–ª–µ–∫—Ç–æ—Ä ${selectId} –∑–∞–ø–æ–ª–Ω–µ–Ω: ${options.length} –æ–ø—Ü–∏–π`);
}

// –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Å–µ–∫—Ü–∏–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤ (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è)
function showRecipesSection() {
    recipesSection.style.display = 'block';
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ–∫–∞–∑–µ —Å–µ–∫—Ü–∏–∏
    if (!window.preferencesLoaded) {
        loadPreferences();
        window.preferencesLoaded = true;
    }
}
    </script>
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
<div class="notification-container" id="notification-container"></div>
</body>
</html>